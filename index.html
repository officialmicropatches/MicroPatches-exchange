<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MicroPatches ‚Äî Patch Exchange Program</title>

  <style>
    :root {
      --navy: #1a2235;
      --steel: #2e3f5c;
      --mid: #4a5a72;
      --gold: #c9a84c;
      --gold-light: #e8c97a;
      --offwhite: #f2ede6;
      --warm-gray: #b0a898;
      --text: #2a2a2a;
      --card-bg: #ffffff;
      --section-bg: #f7f3ed;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, 'Helvetica Neue', Arial, sans-serif;
      background: var(--offwhite);
      color: var(--text);
      min-height: 100vh;
    }

    header {
      background: var(--navy);
      padding: 0;
      position: relative;
      overflow: hidden;
    }

    header::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: repeating-linear-gradient(
        45deg,
        transparent,
        transparent 40px,
        rgba(201,168,76,0.04) 40px,
        rgba(201,168,76,0.04) 41px
      );
      pointer-events: none;
    }

    .header-inner {
      max-width: 680px;
      margin: 0 auto;
      padding: 48px 24px 40px;
      text-align: center;
      position: relative;
      z-index: 1;
    }

    .badge {
      display: inline-block;
      background: var(--gold);
      color: var(--navy);
      font-family: 'Impact', 'Arial Narrow', sans-serif;
      font-size: 11px;
      letter-spacing: 3px;
      padding: 5px 14px;
      border-radius: 2px;
      margin-bottom: 18px;
    }

    h1 {
      font-family: 'Impact', 'Arial Narrow', sans-serif;
      font-size: clamp(48px, 10vw, 78px);
      color: #fff;
      line-height: 0.95;
      letter-spacing: 2px;
      margin-bottom: 6px;
    }

    h1 span { color: var(--gold); }

    .tagline {
      font-size: 15px;
      color: var(--warm-gray);
      font-weight: 300;
      letter-spacing: 0.5px;
      margin-top: 12px;
    }

    .divider {
      width: 48px;
      height: 2px;
      background: var(--gold);
      margin: 20px auto;
      opacity: 0.7;
    }

    .section { max-width: 680px; margin: 0 auto; padding: 48px 24px; }

    .section-label {
      font-family: 'Impact', 'Arial Narrow', sans-serif;
      font-size: 13px;
      letter-spacing: 4px;
      color: var(--gold);
      margin-bottom: 10px;
    }

    .section h2 {
      font-family: 'Impact', 'Arial Narrow', sans-serif;
      font-size: 36px;
      color: var(--navy);
      letter-spacing: 1px;
      margin-bottom: 28px;
    }

    .steps { display: grid; gap: 16px; }

    .step {
      display: flex;
      gap: 20px;
      align-items: flex-start;
      background: var(--card-bg);
      border: 1px solid #e2ddd5;
      border-radius: 6px;
      padding: 20px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.05);
    }

    .step-num {
      font-family: 'Impact', 'Arial Narrow', sans-serif;
      font-size: 32px;
      color: var(--gold);
      line-height: 1;
      min-width: 32px;
    }

    .step-content h3 { font-weight: 600; font-size: 15px; color: var(--navy); margin-bottom: 4px; }
    .step-content p { font-size: 14px; color: #5a5a5a; line-height: 1.6; }

    .patches-section {
      background: var(--section-bg);
      border-top: 1px solid #e0d9cf;
      border-bottom: 1px solid #e0d9cf;
    }

    .patches-inner { max-width: 680px; margin: 0 auto; padding: 48px 24px; }

    .patch-search {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid #d4cec6;
      border-radius: 6px;
      font-family: -apple-system, 'Helvetica Neue', Arial, sans-serif;
      font-size: 14px;
      background: #fff;
      color: var(--text);
      margin-bottom: 24px;
      outline: none;
      transition: border-color 0.2s;
    }

    .patch-search:focus { border-color: var(--gold); }

    .patch-category { margin-bottom: 32px; }

    .patch-category h3 {
      font-family: 'Impact', 'Arial Narrow', sans-serif;
      font-size: 18px;
      letter-spacing: 2px;
      color: var(--mid);
      border-bottom: 1px solid #d4cec6;
      padding-bottom: 8px;
      margin-bottom: 14px;
    }

    .patch-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 10px;
    }

    .patch-card {
      background: var(--card-bg);
      border: 1px solid #e2ddd5;
      border-radius: 6px;
      padding: 12px 14px;
      font-size: 13px;
      color: var(--text);
      line-height: 1.4;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
      transition: border-color 0.15s, box-shadow 0.15s;
    }

    .patch-card:hover { border-color: var(--gold); box-shadow: 0 2px 8px rgba(201,168,76,0.15); }
    .patch-card.hidden { display: none; }

    .patch-state {
      font-size: 10px;
      letter-spacing: 1.5px;
      color: var(--warm-gray);
      text-transform: uppercase;
      display: block;
      margin-bottom: 2px;
    }

    .patch-name { font-weight: 600; color: var(--navy); display: block; }
    .patch-variant { font-size: 11px; color: var(--gold); margin-top: 2px; display: block; }

    /* ===== LUCKY DAY BANNER ===== */
    #luckyDay {
      display: none;
      background: linear-gradient(135deg, #1a2235 0%, #2e3f5c 100%);
      border: 2px solid var(--gold);
      border-radius: 10px;
      padding: 32px 24px;
      text-align: center;
      margin-top: 8px;
      animation: popIn 0.35s cubic-bezier(0.34,1.56,0.64,1) both;
    }

    @keyframes popIn {
      from { opacity:0; transform:scale(0.92); }
      to { opacity:1; transform:scale(1); }
    }

    #luckyDay .lucky-emoji { font-size: 44px; margin-bottom: 10px; }

    #luckyDay h3 {
      font-family: 'Impact', 'Arial Narrow', sans-serif;
      font-size: 34px;
      color: var(--gold-light);
      letter-spacing: 1px;
      margin-bottom: 10px;
    }

    #luckyDay p {
      font-size: 14px;
      color: var(--warm-gray);
      line-height: 1.7;
      max-width: 460px;
      margin: 0 auto 18px;
    }

    .queue-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 18px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 20px;
    }

    .queue-badge.open {
      background: rgba(45,122,79,0.25);
      border: 1px solid #2d7a4f;
      color: #5ebd8a;
    }

    .queue-badge.pending {
      background: rgba(180,83,9,0.25);
      border: 1px solid #b45309;
      color: #f59e0b;
    }

    .queue-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .queue-badge.open .queue-dot { background: #5ebd8a; animation: blink 1.5s infinite; }
    .queue-badge.pending .queue-dot { background: #f59e0b; }

    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.35} }

    .waitlist-box {
      background: rgba(180,83,9,0.15);
      border: 1px solid rgba(180,83,9,0.5);
      border-radius: 6px;
      padding: 14px 16px;
      font-size: 13px;
      color: #f59e0b;
      text-align: left;
      margin: 0 auto 20px;
      max-width: 460px;
      line-height: 1.6;
    }

    .waitlist-box strong { color: #fbbf24; }

    .claim-btn {
      display: inline-block;
      background: var(--gold);
      color: var(--navy);
      font-family: 'Impact', 'Arial Narrow', sans-serif;
      font-size: 20px;
      letter-spacing: 2px;
      padding: 14px 36px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }

    .claim-btn:hover { background: var(--gold-light); transform: translateY(-2px); }
    .claim-btn:active { transform: translateY(0); }

    /* REWARD SECTION */
    .rewards { max-width: 680px; margin: 0 auto; padding: 48px 24px; }

    .reward-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-top: 16px;
    }

    .reward-card {
      background: var(--navy);
      color: #fff;
      border-radius: 8px;
      padding: 28px 20px;
      text-align: center;
    }

    .reward-icon { font-size: 36px; margin-bottom: 12px; }

    .reward-card h3 {
      font-family: 'Impact', 'Arial Narrow', sans-serif;
      font-size: 22px;
      letter-spacing: 1px;
      color: var(--gold-light);
      margin-bottom: 6px;
    }

    .reward-card p { font-size: 13px; color: var(--warm-gray); line-height: 1.5; }

    /* CONTACT FORM */
    .contact-section { background: var(--steel); }

    .contact-inner { max-width: 680px; margin: 0 auto; padding: 48px 24px; }
    .contact-inner .section-label { color: var(--gold-light); }

    .agency-notice {
      display: none;
      border-radius: 6px;
      padding: 13px 16px;
      font-size: 13px;
      margin-bottom: 20px;
      line-height: 1.6;
      border: 1px solid;
    }

    .agency-notice.open { background: rgba(45,122,79,0.15); border-color: #2d7a4f; color: #5ebd8a; }
    .agency-notice.pending { background: rgba(180,83,9,0.15); border-color: #b45309; color: #f59e0b; }
    .agency-notice.locked { background: rgba(100,0,0,0.15); border-color: #7f1d1d; color: #fca5a5; }

    .form-group { margin-bottom: 16px; }

    label {
      display: block;
      font-size: 12px;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--warm-gray);
      margin-bottom: 6px;
      font-weight: 600;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px 14px;
      background: rgba(255,255,255,0.07);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 5px;
      color: #fff;
      font-family: -apple-system, 'Helvetica Neue', Arial, sans-serif;
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s;
    }

    input::placeholder, textarea::placeholder { color: rgba(255,255,255,0.3); }
    input:focus, select:focus, textarea:focus { border-color: var(--gold); }
    select option { background: var(--steel); color: #fff; }
    textarea { resize: vertical; min-height: 90px; }

    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }

    .submit-btn {
      display: block;
      width: 100%;
      padding: 16px;
      background: var(--gold);
      color: var(--navy);
      border: none;
      border-radius: 5px;
      font-family: 'Impact', 'Arial Narrow', sans-serif;
      font-size: 20px;
      letter-spacing: 2px;
      cursor: pointer;
      margin-top: 8px;
      transition: background 0.2s, transform 0.1s;
    }

    .submit-btn:hover { background: var(--gold-light); transform: translateY(-1px); }
    .submit-btn:active { transform: translateY(0); }

    .form-note {
      font-size: 12px;
      color: rgba(255,255,255,0.35);
      margin-top: 14px;
      text-align: center;
      line-height: 1.6;
    }

    .success-msg {
      display: none;
      border-radius: 8px;
      padding: 28px 24px;
      text-align: center;
      font-size: 14px;
      margin-top: 16px;
      line-height: 1.8;
      border: 1px solid;
    }

    .success-msg.first { background: rgba(45,122,79,0.2); border-color: #2d7a4f; color: #5ebd8a; }
    .success-msg.waitlist { background: rgba(180,83,9,0.15); border-color: #b45309; color: #f59e0b; }

    .success-msg h4 {
      font-family: 'Impact', 'Arial Narrow', sans-serif;
      font-size: 26px;
      letter-spacing: 1px;
      margin-bottom: 10px;
    }

    footer {
      background: var(--navy);
      text-align: center;
      padding: 28px 24px;
      font-size: 12px;
      color: rgba(255,255,255,0.3);
      letter-spacing: 0.5px;
      cursor: default;
      user-select: none;
    }

    footer a { color: var(--gold); text-decoration: none; }

    @keyframes fadeUp { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }
    .fade-up { opacity:0; animation: fadeUp 0.5s ease forwards; }
    .fade-up:nth-child(1){animation-delay:0.1s}
    .fade-up:nth-child(2){animation-delay:0.2s}
    .fade-up:nth-child(3){animation-delay:0.3s}
    .fade-up:nth-child(4){animation-delay:0.4s}

    @media(max-width:480px){
      .form-row{grid-template-columns:1fr}
      .reward-options{grid-template-columns:1fr}
      .patch-grid{grid-template-columns:repeat(auto-fill,minmax(140px,1fr))}
    }
  </style>
</head>

<body>
  <header>
    <div class="header-inner">
      <div class="badge">MICROPATCHES</div>
      <h1>PATCH<br><span>EXCHANGE</span></h1>
      <div class="divider"></div>
      <p class="tagline">Trade your agency patch for a custom keychain or magnet ‚Äî 1 for 1.</p>
    </div>
  </header>

  <section class="section">
    <div class="section-label">THE PROGRAM</div>
    <h2>How It Works</h2>
    <div class="steps">
      <div class="step fade-up">
        <div class="step-num">01</div>
        <div class="step-content">
          <h3>Search Our Lineup</h3>
          <p>Type your agency in the search below. If we <strong>don't already have your patch</strong>, you're eligible for the exchange.</p>
        </div>
      </div>
      <div class="step fade-up">
        <div class="step-num">02</div>
        <div class="step-content">
          <h3>Claim Your Spot</h3>
          <p>Fill out the form to reserve your place. <strong>One primary spot per agency</strong> ‚Äî if it's taken, you'll be added to the waitlist automatically.</p>
        </div>
      </div>
      <div class="step fade-up">
        <div class="step-num">03</div>
        <div class="step-content">
          <h3>Send Your Patch</h3>
          <p>After we confirm eligibility via email, mail us your agency patch. <strong>You only cover shipping to us</strong> ‚Äî we'll cover shipping your keychain or magnet back to you. We finalize the exchange once the patch is in hand.</p>
        </div>
      </div>
      <div class="step fade-up">
        <div class="step-num">04</div>
        <div class="step-content">
          <h3>Get Your Reward</h3>
          <p>Choose a <strong>custom keychain</strong> or <strong>magnet</strong> in your agency's patch design ‚Äî handmade at MicroPatches.</p>
        </div>
      </div>
    </div>
  </section>

  <section style="background: var(--section-bg); border-top: 1px solid #e0d9cf;">
    <div class="rewards">
      <div class="section-label">YOUR CHOICE</div>
      <h2 style="font-family:'Impact', 'Arial Narrow',sans-serif;font-size:36px;color:var(--navy);letter-spacing:1px;margin-bottom:4px;">Pick Your Reward</h2>
      <p style="font-size:14px;color:#5a5a5a;margin-bottom:0;">Each exchange earns you one of the following ‚Äî made in your agency's patch design.</p>
      <div class="reward-options">
        <div class="reward-card">
          <div class="reward-icon">üîë</div>
          <h3>Keychain</h3>
          <p>3D printed, durable, full-color patch keychain you can carry every day.</p>
        </div>
        <div class="reward-card">
          <div class="reward-icon">üß≤</div>
          <h3>Magnet</h3>
          <p>High-quality patch magnet ‚Äî perfect for your locker, vehicle, or fridge.</p>
        </div>
      </div>
    </div>
  </section>

  <section class="patches-section">
    <div class="patches-inner">
      <div class="section-label">CURRENT INVENTORY</div>
      <h2 style="font-family:'Impact', 'Arial Narrow',sans-serif;font-size:36px;color:var(--navy);letter-spacing:1px;margin-bottom:6px;">Patches We Have</h2>
      <p style="font-size:14px;color:#5a5a5a;margin-bottom:24px;">If your agency is <strong>not listed below</strong>, you're eligible to participate.</p>

      <input type="text" class="patch-search" placeholder="Search your agency or state..." id="searchInput" oninput="filterPatches()">

      <div class="patch-category" id="cat-le">
        <h3>Law Enforcement</h3>
        <div class="patch-grid">
          <div class="patch-card"><span class="patch-state">Arizona</span><span class="patch-name">Chandler PD</span></div>
          <div class="patch-card"><span class="patch-state">Arizona</span><span class="patch-name">Chandler PD</span><span class="patch-variant">Retired</span></div>
          <div class="patch-card"><span class="patch-state">Arizona</span><span class="patch-name">Chandler PD</span><span class="patch-variant">Pink Patch Program</span></div>
          <div class="patch-card"><span class="patch-state">Arizona</span><span class="patch-name">Tempe PD</span></div>
          <div class="patch-card"><span class="patch-state">Arizona</span><span class="patch-name">Tempe PD</span><span class="patch-variant">Subdued</span></div>
          <div class="patch-card"><span class="patch-state">Arizona</span><span class="patch-name">Gilbert PD</span></div>
          <div class="patch-card"><span class="patch-state">Arizona</span><span class="patch-name">Phoenix PD</span></div>
          <div class="patch-card"><span class="patch-state">Arizona</span><span class="patch-name">Prescott PD</span></div>
          <div class="patch-card"><span class="patch-state">Arizona</span><span class="patch-name">AZ DPS</span></div>
          <div class="patch-card"><span class="patch-state">Arizona</span><span class="patch-name">Tucson PD</span></div>
          <div class="patch-card"><span class="patch-state">Arizona</span><span class="patch-name">Scottsdale PD</span><span class="patch-variant">Retired</span></div>
          <div class="patch-card"><span class="patch-state">Arizona</span><span class="patch-name">SCORE Jail</span></div>
          <div class="patch-card"><span class="patch-state">Arizona</span><span class="patch-name">Gila River Indian Police</span></div>
          <div class="patch-card"><span class="patch-state">Washington</span><span class="patch-name">Auburn PD</span></div>
          <div class="patch-card"><span class="patch-state">Washington</span><span class="patch-name">Auburn PD</span><span class="patch-variant">Retired</span></div>
          <div class="patch-card"><span class="patch-state">Washington</span><span class="patch-name">Pierce County Sheriff</span></div>
          <div class="patch-card"><span class="patch-state">Washington</span><span class="patch-name">Tacoma PD</span></div>
          <div class="patch-card"><span class="patch-state">Hawaii</span><span class="patch-name">Honolulu PD</span></div>
          <div class="patch-card"><span class="patch-state">Hawaii</span><span class="patch-name">Maui PD</span></div>
          <div class="patch-card"><span class="patch-state">California</span><span class="patch-name">San Jose PD</span></div>
          <div class="patch-card"><span class="patch-state">Nevada</span><span class="patch-name">Las Vegas Metro PD</span></div>
          <div class="patch-card"><span class="patch-state">New Mexico</span><span class="patch-name">Valencia County Sheriff</span></div>
          <div class="patch-card"><span class="patch-state">New Mexico</span><span class="patch-name">Albuquerque PD</span></div>
          <div class="patch-card"><span class="patch-state">New York</span><span class="patch-name">NYPD</span></div>
          <div class="patch-card"><span class="patch-state">Illinois</span><span class="patch-name">Chicago PD</span></div>
          <div class="patch-card"><span class="patch-state">New Hampshire</span><span class="patch-name">Portsmouth PD</span></div>
          <div class="patch-card"><span class="patch-state">Maine</span><span class="patch-name">Maine State Police</span></div>
          <div class="patch-card"><span class="patch-state">Federal</span><span class="patch-name">FBI SWAT</span></div>
        </div>
      </div>

      <div class="patch-category" id="cat-ems">
        <h3>EMS / Fire</h3>
        <div class="patch-grid">
          <div class="patch-card"><span class="patch-state">National</span><span class="patch-name">AMR (EMT)</span></div>
        </div>
      </div>

      <div class="patch-category" id="cat-mil">
        <h3>Military</h3>
        <div class="patch-grid">
          <div class="patch-card"><span class="patch-state">U.S. Army</span><span class="patch-name">82nd Airborne</span></div>
        </div>
      </div>

      <!-- LUCKY DAY BANNER -->
      <div id="luckyDay">
        <div class="lucky-emoji">üéâ</div>
        <h3>It's Your Lucky Day!</h3>
        <p id="luckyMsg">We don't have your patch yet ‚Äî which means you're eligible for the exchange. Claim your spot now and get a custom keychain or magnet of your agency's patch.</p>
        <div id="queueBadge" class="queue-badge open">
          <span class="queue-dot"></span>
          <span id="queueBadgeText">Spot Open ‚Äî Be the First!</span>
        </div>
        <div id="waitlistBox" class="waitlist-box" style="display:none;">
          ‚ö†Ô∏è <strong>Heads up:</strong> Someone has already submitted for this agency but we haven't received their patch yet. You can still fill out the form and be placed on the <strong>waitlist</strong>. If the primary submission falls through, we'll contact you next ‚Äî no patch required from you until then.
        </div>
        <br>
        <button class="claim-btn" onclick="scrollToForm()">CLAIM YOUR SPOT ‚Üí</button>
      </div>

    </div>
  </section>

  <section class="contact-section" id="formSection">
    <div class="contact-inner">
      <div class="section-label">GET STARTED</div>
      <h2 style="font-family:'Impact', 'Arial Narrow',sans-serif;font-size:36px;color:#fff;letter-spacing:1px;margin-bottom:18px;">Submit Your Exchange</h2>

      <div id="agencyNotice" class="agency-notice"></div>

      <form id="exchangeForm">
        <div class="form-row">
          <div class="form-group">
            <label>First Name</label>
            <input type="text" id="firstName" name="firstName" placeholder="John" required>
          </div>
          <div class="form-group">
            <label>Last Name</label>
            <input type="text" id="lastName" name="lastName" placeholder="Smith" required>
          </div>
        </div>

        <div class="form-group">
          <label>Email Address</label>
          <input type="email" id="emailInput" name="email" placeholder="you@example.com" required>
        </div>

        <div class="form-group">
          <label>Agency / Department Name</label>
          <input type="text" id="agencyInput" name="agency" placeholder="e.g. Mesa Police Department" required oninput="checkAgency()">
        </div>

        <div class="form-group">
          <label>State</label>
          <input type="text" id="stateInput" name="state" placeholder="e.g. Arizona" required>
        </div>

        <div class="form-group">
          <label>I Want In Exchange</label>
          <select id="rewardSelect" name="reward" required>
            <option value="" disabled selected>Select your reward...</option>
            <option>Keychain ‚Äî Agency Patch Design</option>
            <option>Magnet ‚Äî Agency Patch Design</option>
          </select>
        </div>

        <div class="form-group">
          <label>Anything else we should know?</label>
          <textarea id="notesInput" name="notes" placeholder="Notes, questions, patch details, etc."></textarea>
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">SUBMIT EXCHANGE REQUEST</button>
        <p class="form-note">
          After submitting, we'll email you within 24‚Äì48 hours with confirmation and our mailing address.
          <strong>Do NOT send your patch until you've heard from us.</strong><br><br>
          üì¶ <strong>Shipping breakdown:</strong> You cover postage to send your patch to us ‚Äî we cover shipping your keychain or magnet back to you. Totally free on our end.
        </p>
      </form>

      <div class="success-msg" id="successMsg"></div>
    </div>
  </section>

  <footer id="footerEl">
    <p>¬© 2025 MicroPatches ¬∑ All Rights Reserved</p>
    <p style="margin-top:6px;"><a href="https://instagram.com/micropatches" target="_blank">@MicroPatches</a> on Instagram</p>
  </footer>

  <script>
    // NOTE:
    // Your original queue system used `window.storage`, which does not exist on GitHub Pages.
    // These functions are left here so the UI doesn't throw errors, but queue/admin features are disabled.
    // Firebase submission below DOES work.

    function filterPatches() {
      const q = document.getElementById('searchInput').value.trim().toLowerCase();
      const cards = document.querySelectorAll('.patch-card');
      let anyVisible = false;

      cards.forEach(card => {
        const match = q && card.textContent.toLowerCase().includes(q);
        if (!q || match) { card.classList.remove('hidden'); if (q) anyVisible = true; }
        else card.classList.add('hidden');
      });

      document.querySelectorAll('.patch-category').forEach(cat => {
        if (!q) { cat.style.display = ''; return; }
        cat.style.display = cat.querySelectorAll('.patch-card:not(.hidden)').length > 0 ? '' : 'none';
      });

      const lucky = document.getElementById('luckyDay');
      if (!q || anyVisible || q.length < 2) { lucky.style.display = 'none'; return; }

      // Without queue storage, we simply show eligibility banner when not found.
      lucky.style.display = 'block';
      const badge = document.getElementById('queueBadge');
      const wBox = document.getElementById('waitlistBox');
      const msg = document.getElementById('luckyMsg');

      badge.className = 'queue-badge open';
      badge.innerHTML = '<span class="queue-dot"></span><span>Spot Open ‚Äî Be the First!</span>';
      wBox.style.display = 'none';
      msg.textContent = "We don't have your patch yet ‚Äî which means you're eligible for the exchange. Claim your spot now and get a custom keychain or magnet of your agency's patch.";
    }

    let checkTimer = null;

    function checkAgency() {
      clearTimeout(checkTimer);
      checkTimer = setTimeout(() => {
        const agency = document.getElementById('agencyInput').value.trim();
        const notice = document.getElementById('agencyNotice');
        const btn = document.getElementById('submitBtn');

        if (agency.length < 3) { notice.style.display = 'none'; btn.textContent = 'SUBMIT EXCHANGE REQUEST'; return; }

        // Queue logic disabled on GitHub Pages unless you migrate it to Firebase.
        notice.className = 'agency-notice open';
        notice.style.display = 'block';
        notice.innerHTML = '‚úÖ <strong>Spot available!</strong> (Queue logic is currently disabled on this build ‚Äî submissions still go through.)';
        btn.textContent = 'SUBMIT EXCHANGE REQUEST';
      }, 400);
    }

    function scrollToForm() {
      const search = document.getElementById('searchInput').value.trim();
      if (search.length >= 2) {
        document.getElementById('agencyInput').value = search;
        checkAgency();
      }
      document.getElementById('formSection').scrollIntoView({ behavior: 'smooth' });
      setTimeout(() => document.getElementById('agencyInput').focus(), 650);
    }
  </script>

  <!-- FIREBASE SUBMISSION (WORKING) -->
  <!-- FIREBASE SUBMISSION (WORKING) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDkNCYz7DXKF2Ku8B4FfN1gXdVV3P3B2YE",
    authDomain: "micropatches-exchange.firebaseapp.com",
    databaseURL: "https://micropatches-exchange-default-rtdb.firebaseio.com",
    projectId: "micropatches-exchange",
    storageBucket: "micropatches-exchange.firebasestorage.app",
    messagingSenderId: "953111257361",
    appId: "1:953111257361:web:e18c2403e222cf97b6cb0"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const form = document.getElementById("exchangeForm");

  console.log("Firebase initialized.");
  console.log("Form found:", !!form);

  if (form) {
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      try {
        const data = Object.fromEntries(new FormData(form).entries());
        console.log("Data about to push:", data);

        const result = await push(ref(db, "exchangeQueue"), {
          ...data,
          timestamp: Date.now()
        });

        console.log("Firebase push key:", result.key);
        alert("Submission received.");
        form.reset();
      } catch (err) {
        console.error("Firebase error:", err);
        alert("Firebase error. Check console.");
      }
    });
  } else {
    console.error("No form found on page");
  }
</script>
</body>
</html>
